---
title: Alternating Cyclic Extrapolation for MDS Acceleration
author: 
    - name: Jan de Leeuw
      orcid: 0000-0003-1420-1797
      email: jan@deleeuwpdx.net
      affiliation: 
        - name: University of California Los Angeles
          city: Los Angeles
          state: CA
          url: www.ucla.edu
      license: "CC0"
date: last-modified
date-format: long
bibliography: [mypubs.bib, total.bib]
number-sections: true
pdf-engine: lualatex
keep-tex: true
format:
   pdf:
    fontsize: 12pt
    include-in-header: 
     - preamble.tex
    keep-tex: true
    link-citations: true
    documentclass: scrartcl
    number-sections: true
   html:
    fontsize: 12pt
    include-in-header: 
     - preamble.css
    keep-md: true
    number-sections: true
toc: true
toc-depth: 3
editor: source
papersize: letter
graphics: true 
link-citations: true
mainfont: Times New Roman
abstract: We use a new cyclic vector extrapolation method due to Nicolas Lepage-Saucier to accelerate   convergence of smacof iterations in Multidimensional Scaling. Software, written in R, is used to
  compare the effect of various strategies on the number of iterations and the time to convergence.
---

```{r loadpackages, echo = FALSE}
suppressPackageStartupMessages(library(knitr, quietly = TRUE))
suppressPackageStartupMessages(library(tinytex, quietly = TRUE))
suppressPackageStartupMessages(library(RSpectra, quietly = TRUE))
suppressPackageStartupMessages(library(microbenchmark, quietly = TRUE))
```

```{r loadsources, echo = FALSE}
source("smacofACX.R")
source("acxEkman.R")
source("acxGruijter.R")
source("acxMorse.R")
```

**Note:** This is a working manuscript which will be expanded/updated
frequently. All suggestions for improvement are welcome. All Rmd, tex,
html, pdf, R, and C files are in the public domain. Attribution will be
appreciated, but is not required. The files can be found at
<https://github.com/deleeuw/ACX> 

\sectionbreak

# Introduction

The standard iterative methods for Multidimensional Scaling (MDS), such as *smacof* (@deleeuw_mair_A_09c, @mair_groenen_deleeuw_A_22) and *ALSCAL* (@takane_young_deleeuw_A_77), can be quite slow to converge. Thus there have been various attempts to use standard numerical analysis
techniques to accelerate MDS convergence. But none of these methods, despite of being quite successful, has been implemented in the usual MDS techniques.

@ramsay_75 used multivariate Aitkin acceleration on various problems in psychometrics and statistics. including MDS.
In @groenen_glunt_hayden_96 standard *smacof* iterations were compared with iterations of the
spectral gradient method.
@rosman_bronstein_bronstein_sidi_kimmel_08
@deleeuw_R_06b
@deleeuw_R_08i


@lepage_saucier_24

# Equations

A *strategy* is a vector $\ell$ of $n\geq 1$ integers, with 
$0\leq \ell_i\leq 3$. Strategies are used to code $n$ *updates*,
with update $i$ has *order* $\ell_i$. Iterations repeat
strategies cyclically. Thus strategy $(0,0,3)$ means that
iterations use updates of order $(0,0,3,0,0,3,...)$, while 
$(1,0)$ means the order sequence $(1,0,1,0,1,0,...)$.
The theory in @lepage_saucier_24 allows one to go to orders
hgher than three, but we will use these in this paper.

To define orders zero to three for smacof we use the Guttman transform $\Gamma$ of an MDS configuration. In iteration $k$ we compute
\begin{subequations}
\begin{align}
\Delta_0^{(k)}&:=X^{(k)},\\
\Delta_1^{(k)}&:=\Gamma(X^{(k)})-X^{(k)},\\
\Delta_2^{(k)}&:=\Gamma^2(X^{(k)})-2\Gamma(X^{(k)})+X^{(k)},\\
\Delta_3^{(k)}&:=\Gamma^3(X^{(k)})-3\Gamma^2(X^{(k)})+3\Gamma(X^{(k)})-X^{(k)}.
\end{align}
\end{subequations}
0. Order zero are the standard smacof iterations
\begin{equation}
X^{(k+1)}=\Gamma(X^{(k)}).
\end{equation}
1. For order one
\begin{subequations}
\begin{align}
\lambda_1^{(k)}&:=\frac{\langle\Delta_0^{(k)},\Delta_1^{(k)}\rangle}{\langle\Delta_1^{(k)},\Delta_1^{(k)}\rangle},\\
X^{(k+1)}&=\Delta_0^{(k)}+\lambda_1^{(k)}\Delta_1^{(k)}.
\end{align}
\end{subequations}
2. For order two
\begin{subequations}
\begin{align}
\lambda_2^{(k)}&:=\frac{\langle\Delta_1^{(k)},\Delta_2^{(k)}\rangle}{\langle\Delta_2^{(k)},\Delta_2^{(k)}\rangle},\\
X^{(k+1)}&=\Delta_0^{(k)}+2\lambda_2^{(k)}\Delta_1^{(k)}+\left[\lambda_2^{(k)}\right]^2\Delta_2^{(k)}.
\end{align}
\end{subequations}
3. For order three
\begin{subequations}
\begin{align}
\lambda_3^{(k)}&:=\frac{\langle\Delta_2^{(k)},\Delta_3^{(k)}\rangle}{\langle\Delta_3^{(k)},\Delta_3^{(k)}\rangle},\\
X^{(k+1)}&=\Delta_0^{(k)}+3\lambda_3^{(k)}\Delta_1^{(k)}+3\left[\lambda_3^{(k)}\right]^2\Delta_2^{(k)}+
\left[\lambda_3^{(k)}\right]^3\Delta_3^{(k)}.
\end{align}
\end{subequations}

# Software

```{r}
args(smacofACX)
```

\sectionbreak

# Comparing Strategies

In this section we compare the strategies $(x)$ and $(0,x)$, where $x$
is one of 0,1,2,3. Of course strategy $(0)$ is identical to strategy
$(0,0)$, because both implement a sequence of ordinary smacof iterations. In addition we vary the *safe* parameter.


## Data

## Number of Iterations

We iterate a maximum of 1000 times and we stop if the sup-norm $\|X^{(k+1)}-X^{(k)}\|_\infty$ is less than  $10^{-6}$. This is a much stricter stop citerium as the one used in *smacof*, which stops if the change in loss function value 
$\sigma^{(k)}-\sigma^{(k+1)}$ is less than 
$10^{-6}$. We always start with the classical scaling (Torgerson-Gower) solution.


### Strategy (x)

```{r xF, cache = TRUE, echo = FALSE}
he0 <- smacofACX(ekman, strategy = 0, verbose = FALSE, safe = FALSE)
he1 <- smacofACX(ekman, strategy = 1, verbose = FALSE, safe = FALSE)
he2 <- smacofACX(ekman, strategy = 2, verbose = FALSE, safe = FALSE)
he3 <- smacofACX(ekman, strategy = 3, verbose = FALSE, safe = FALSE)
hg0 <- smacofACX(gruijter, strategy = 0, verbose = FALSE, safe = FALSE)
hg1 <- smacofACX(gruijter, strategy = 1, verbose = FALSE, safe = FALSE)
hg2 <- smacofACX(gruijter, strategy = 2, verbose = FALSE, safe = FALSE)
hg3 <- smacofACX(gruijter, strategy = 3, verbose = FALSE, safe = FALSE)
hm0 <- smacofACX(morse, strategy = 0, verbose = FALSE, safe = FALSE)
hm1 <- smacofACX(morse, strategy = 1, verbose = FALSE, safe = FALSE)
hm2 <- smacofACX(morse, strategy = 2, verbose = FALSE, safe = FALSE)
hm3 <- smacofACX(morse, strategy = 3, verbose = FALSE, safe = FALSE)
hF<-matrix(c(he0$itel, he1$itel, he2$itel, he3$itel,
        hg0$itel, hg1$itel, hg2$itel, hg3$itel,
        hm0$itel, hm1$itel, hm2$itel, hm3$itel
        ), 3, 4, byrow = TRUE)
row.names(hF) <- c("ekman", "gruijter", "morse")
```

```{r kxF, echo = FALSE, tab.align = "center"}
kable(hF, row.names = TRUE, col.names = c("(0)", "(1)", "(2)", "(3)"),
      caption = "strategy (x), safe = FALSE")
```

```{r xT, cache = TRUE, echo = FALSE}
he0 <- smacofACX(ekman, strategy = 0, verbose = FALSE, safe = TRUE)
he1 <- smacofACX(ekman, strategy = 1, verbose = FALSE, safe = TRUE)
he2 <- smacofACX(ekman, strategy = 2, verbose = FALSE, safe = TRUE)
he3 <- smacofACX(ekman, strategy = 3, verbose = FALSE, safe = TRUE)
hg0 <- smacofACX(gruijter, strategy = 0, verbose = FALSE, safe = TRUE)
hg1 <- smacofACX(gruijter, strategy = 1, verbose = FALSE, safe = TRUE)
hg2 <- smacofACX(gruijter, strategy = 2, verbose = FALSE, safe = TRUE)
hg3 <- smacofACX(gruijter, strategy = 3, verbose = FALSE, safe = TRUE)
hm0 <- smacofACX(morse, strategy = 0, verbose = FALSE, safe = TRUE)
hm1 <- smacofACX(morse, strategy = 1, verbose = FALSE, safe = TRUE)
hm2 <- smacofACX(morse, strategy = 2, verbose = FALSE, safe = TRUE)
hm3 <- smacofACX(morse, strategy = 3, verbose = FALSE, safe = TRUE)
hT<-matrix(c(he0$itel, he1$itel, he2$itel, he3$itel,
        hg0$itel, hg1$itel, hg2$itel, hg3$itel,
        hm0$itel, hm1$itel, hm2$itel, hm3$itel
        ), 3, 4, byrow = TRUE)
row.names(hT) <- c("ekman", "gruijter", "morse")
```

```{r kxT, echo = FALSE, tab.align = "center"}
kable(hT, row.names = TRUE, col.names = c("(0)", "(1)", "(2)", "(3)"),
      caption = "strategy (x), safe = TRUE")
```

### Strategy (0,x)

```{r 0xF, cache = TRUE, echo = FALSE}
he1 <- smacofACX(ekman, strategy = c(0,1), verbose = FALSE, safe = FALSE)
he2 <- smacofACX(ekman, strategy = c(0,2), verbose = FALSE, safe = FALSE)
he3 <- smacofACX(ekman, strategy = c(0,3), verbose = FALSE, safe = FALSE)
hg1 <- smacofACX(gruijter, strategy = c(0,1), verbose = FALSE, safe = FALSE)
hg2 <- smacofACX(gruijter, strategy = c(0,2), verbose = FALSE, safe = FALSE)
hg3 <- smacofACX(gruijter, strategy = c(0,3), verbose = FALSE, safe = FALSE)
hm1 <- smacofACX(morse, strategy = c(0,1), verbose = FALSE, safe = FALSE)
hm2 <- smacofACX(morse, strategy = c(0,2), verbose = FALSE, safe = FALSE)
hm3 <- smacofACX(morse, strategy = c(0,3), verbose = FALSE, safe = FALSE)
h<-matrix(c(he0$itel, he1$itel, he2$itel, he3$itel,
        hg0$itel, hg1$itel, hg2$itel, hg3$itel,
        hm0$itel, hm1$itel, hm2$itel, hm3$itel
        ), 3, 4, byrow = TRUE)
row.names(h) <- c("ekman", "gruijter", "morse")
```

```{r k0xF, echo = FALSE, tab.align = "center"}
kable(h, row.names = TRUE, col.names = c("(0,0)", "(0,1)", "(0,2)", "(0,3)"),
      caption = "strategy (0,x), safe = FALSE")
```


```{r 0xT, cache = TRUE, echo = FALSE}
he1 <- smacofACX(ekman, strategy = c(0,1), verbose = FALSE, safe = TRUE)
he2 <- smacofACX(ekman, strategy = c(0,2), verbose = FALSE, safe = TRUE)
he3 <- smacofACX(ekman, strategy = c(0,3), verbose = FALSE, safe = TRUE)
hg1 <- smacofACX(gruijter, strategy = c(0,1), verbose = FALSE, safe = TRUE)
hg2 <- smacofACX(gruijter, strategy = c(0,2), verbose = FALSE, safe = TRUE)
hg3 <- smacofACX(gruijter, strategy = c(0,3), verbose = FALSE, safe = TRUE)
hm1 <- smacofACX(morse, strategy = c(0,1), verbose = FALSE, safe = TRUE)
hm2 <- smacofACX(morse, strategy = c(0,2), verbose = FALSE, safe = TRUE)
hm3 <- smacofACX(morse, strategy = c(0,3), verbose = FALSE, safe = TRUE)
h<-matrix(c(he0$itel, he1$itel, he2$itel, he3$itel,
        hg0$itel, hg1$itel, hg2$itel, hg3$itel,
        hm0$itel, hm1$itel, hm2$itel, hm3$itel
        ), 3, 4, byrow = TRUE)
row.names(h) <- c("ekman", "gruijter", "morse")
```

```{r k0xT, echo = FALSE, tab.align = "center"}
kable(h, row.names = TRUE, col.names = c("(0,0)", "(0,1)", "(0,2)", "(0,3)"),
      caption = "strategy (0,x), safe = TRUE")
```

## Timing

### Strategy (x)

```{r mxF, echo = FALSE, cache = TRUE}
suppressWarnings(
h <- microbenchmark(
smacofACX(ekman, strategy = 0, verbose = FALSE, safe = FALSE),
smacofACX(ekman, strategy = 1, verbose = FALSE, safe = FALSE),
smacofACX(ekman, strategy = 2, verbose = FALSE, safe = FALSE),
smacofACX(ekman, strategy = 3, verbose = FALSE, safe = FALSE),
smacofACX(gruijter, strategy = 0, verbose = FALSE, safe = FALSE),
smacofACX(gruijter, strategy = 1, verbose = FALSE, safe = FALSE),
smacofACX(gruijter, strategy = 2, verbose = FALSE, safe = FALSE),
smacofACX(gruijter, strategy = 3, verbose = FALSE, safe = FALSE),
smacofACX(morse, strategy = 0, verbose = FALSE, safe = FALSE),
smacofACX(morse, strategy = 1, verbose = FALSE, safe = FALSE),
smacofACX(morse, strategy = 2, verbose = FALSE, safe = FALSE),
smacofACX(morse, strategy = 3, verbose = FALSE, safe = FALSE)))
```

```{r pxF, echo = FALSE, tab.align = "center"}
mh <- matrix(c(1964,57315,537,532, 
               32028, 27371, 2218,3527,
               33178,56410,3547,4445), 3, 4, byrow = TRUE)
row.names(mh) <- c("ekman", "gruijter", "morse")
kable(mh, row.names = TRUE, col.names = c("(0)", "(1)", "(2)", "(3)"),
      caption = "strategy (x), safe = FALSE")
```

```{r mxT, echo = FALSE, cache = TRUE}
suppressWarnings(h <- microbenchmark(
smacofACX(ekman, strategy = 0, verbose = FALSE, safe = TRUE),
smacofACX(ekman, strategy = 1, verbose = FALSE, safe = TRUE),
smacofACX(ekman, strategy = 2, verbose = FALSE, safe = TRUE),
smacofACX(ekman, strategy = 3, verbose = FALSE, safe = TRUE),
smacofACX(gruijter, strategy = 0, verbose = FALSE, safe = TRUE),
smacofACX(gruijter, strategy = 1, verbose = FALSE, safe = TRUE),
smacofACX(gruijter, strategy = 2, verbose = FALSE, safe = TRUE),
smacofACX(gruijter, strategy = 3, verbose = FALSE, safe = TRUE),
smacofACX(morse, strategy = 0, verbose = FALSE, safe = TRUE),
smacofACX(morse, strategy = 1, verbose = FALSE, safe = TRUE),
smacofACX(morse, strategy = 2, verbose = FALSE, safe = TRUE),
smacofACX(morse, strategy = 3, verbose = FALSE, safe = TRUE)))
```
```{r pxT, echo = FALSE, tab.align = "center"}
mh <- matrix(c(1974,1080,535,526, 
               32564,24020,2089,2575,
               32841,23130,3222,4190), 3, 4, byrow = TRUE)
row.names(mh) <- c("ekman", "gruijter", "morse")
kable(mh, row.names = TRUE, col.names = c("(0)", "(1)", "(2)", "(3)"),
      caption = "strategy (x), safe = TRUE")
```

### Strategy (0,x)

```{r m0xF, cache = TRUE, echo = FALSE}
suppressWarnings(h <- microbenchmark(
smacofACX(ekman, strategy = c(0,1), verbose = FALSE, safe = FALSE),
smacofACX(ekman, strategy = c(0,2), verbose = FALSE, safe = FALSE),
smacofACX(ekman, strategy = c(0,3), verbose = FALSE, safe = FALSE),
smacofACX(gruijter, strategy = c(0,1), verbose = FALSE, safe = FALSE),
smacofACX(gruijter, strategy = c(0,2), verbose = FALSE, safe = FALSE),
smacofACX(gruijter, strategy = c(0,3), verbose = FALSE, safe = FALSE),
smacofACX(morse, strategy = c(0,1), verbose = FALSE, safe = FALSE),
smacofACX(morse, strategy = c(0,2), verbose = FALSE, safe = FALSE),
smacofACX(morse, strategy = c(0,3), verbose = FALSE, safe = FALSE)))
```
```{r p0xF, echo = FALSE, tab.align = "center"}
mh <- matrix(c(1467,584,656,
               26266,2910,2543,
               26074,4162,4028), 3, 3, byrow = TRUE)
row.names(mh) <- c("ekman", "gruijter", "morse")
kable(mh, row.names = TRUE, col.names = c("(0,1)", "(0,2)", "(0,3)"),
      caption = "strategy (0,x), safe = FALSE")
```

```{r m0xT, cache = TRUE, echo = FALSE}
suppressWarnings(h <- microbenchmark(
smacofACX(ekman, strategy = c(0,1), verbose = FALSE, safe = TRUE),
smacofACX(ekman, strategy = c(0,2), verbose = FALSE, safe = TRUE),
smacofACX(ekman, strategy = c(0,3), verbose = FALSE, safe = TRUE),
smacofACX(gruijter, strategy = c(0,1), verbose = FALSE, safe = TRUE),
smacofACX(gruijter, strategy = c(0,2), verbose = FALSE, safe = TRUE),
smacofACX(gruijter, strategy = c(0,3), verbose = FALSE, safe = TRUE),
smacofACX(morse, strategy = c(0,1), verbose = FALSE, safe = TRUE),
smacofACX(morse, strategy = c(0,2), verbose = FALSE, safe = TRUE),
smacofACX(morse, strategy = c(0,3), verbose = FALSE, safe = TRUE)))
```
```{r p0xT, echo = FALSE, tab.align = "center"}
mh <- matrix(c(1466,584,654,25584,2544,2795,25898,4103,3986), 3, 3, byrow = TRUE)
row.names(mh) <- c("ekman", "gruijter", "morse")
kable(mh, row.names = TRUE, col.names = c("(0,1)", "(0,2)", "(0,3)"),
      caption = "strategy (0,x), safe = TRUE")
```
\sectionbreak
# References




